(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["cart"],{"80d2":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",{attrs:{id:"member"}},[r("b-row",[r("b-col",{staticClass:"mt-5",attrs:{cols:"12"}},[r("b-jumbotron",{attrs:{id:"jb","text-variant":"white"}},[r("h1",{staticClass:"mt-3"},[t._v(t._s(t.user.name)+" 您好")])])],1),r("b-col",{attrs:{cols:"3"}}),r("b-col",{attrs:{cols:"6"}})],1)],1)},n=[],c=r("1da1"),o=(r("96cf"),r("3eec"),{name:"Member",methods:{logout:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.axios.delete("/users/logout",{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 3:t.$store.commit("logout"),"/"!==t.$route.path&&t.$router.push("/"),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),t.$swal({icon:"error",title:"錯誤",text:"發生錯誤"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()}}}),i=o,s=r("2877"),u=Object(s["a"])(i,a,n,!1,null,null,null);e["default"]=u.exports},a434:function(t,e,r){"use strict";var a=r("23e7"),n=r("23cb"),c=r("a691"),o=r("50c4"),i=r("7b0b"),s=r("65f0"),u=r("8418"),l=r("1dde"),m=l("splice"),d=Math.max,h=Math.min,f=9007199254740991,p="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!m},{splice:function(t,e){var r,a,l,m,b,v,x=i(this),k=o(x.length),w=n(t,k),g=arguments.length;if(0===g?r=a=0:1===g?(r=0,a=k-w):(r=g-2,a=h(d(c(e),0),k-w)),k+r-a>f)throw TypeError(p);for(l=s(x,a),m=0;m<a;m++)b=w+m,b in x&&u(l,m,x[b]);if(l.length=a,r<a){for(m=w;m<k-a;m++)b=m+a,v=m+r,b in x?x[v]=x[b]:delete x[v];for(m=k;m>k-a+r;m--)delete x[m-1]}else if(r>a)for(m=k-a;m>w;m--)b=m+a-1,v=m+r-1,b in x?x[v]=x[b]:delete x[v];for(m=0;m<r;m++)x[m+w]=arguments[m+2];return x.length=k-a+r,l}})},b789:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",{attrs:{id:"cart"}},[r("b-row",[r("b-col",{staticClass:"mt-5",attrs:{cols:"12"}},[r("h1",{staticClass:"text-center"},[t._v("購物車")]),r("br",{staticClass:"m-3"}),r("b-table",{ref:"table",attrs:{items:t.cart,fields:t.fields},scopedSlots:t._u([{key:"cell(image)",fn:function(e){return[e.item?r("img",{staticStyle:{height:"50px"},attrs:{src:e.item.image}}):t._e()]}},{key:"cell(amount)",fn:function(e){return[e.item.edit?r("b-form-input",{attrs:{type:"number",state:e.item.amountModel>0},model:{value:e.item.amountModel,callback:function(r){t.$set(e.item,"amountModel",t._n(r))},expression:"data.item.amountModel"}}):r("span",[t._v(t._s(e.item.amount))])]}},{key:"cell(action)",fn:function(e){return[e.item.edit?t._e():r("b-btn",{attrs:{variant:"outline-success"},on:{click:function(r){return t.editProduct(e.index)}}},[t._v("編輯")]),e.item.edit?t._e():r("b-btn",{staticClass:"ml-3",attrs:{variant:"outline-danger"},on:{click:function(r){return t.delProduct(e.index)}}},[t._v("刪除")]),e.item.edit?r("b-btn",{attrs:{variant:"outline-success"},on:{click:function(r){return t.submitProduct(e.index)}}},[t._v("確定")]):t._e(),e.item.edit?r("b-btn",{attrs:{variant:"outline-danger"},on:{click:function(r){return t.cancelProduct(e.index)}}},[t._v("取消")]):t._e()]}}])}),r("h3",{staticClass:"text-center"},[t._v("總金額 "+t._s(t.totalprice)),r("b-btn",{staticClass:"ml-3",attrs:{variant:"outline-primary"},on:{click:t.checkout}},[t._v("結帳")])],1)],1)],1)],1)},n=[],c=r("5530"),o=r("1da1"),i=(r("96cf"),r("a434"),r("d81d"),r("99af"),{name:"Cart",data:function(){return{cart:[],fields:[{key:"image",label:"圖片"},{key:"name",label:"品名"},{key:"amount",label:"數量"},{key:"price",label:"價格"},{key:"action",label:"操作"}]}},computed:{totalprice:function(){return 0===this.cart.length?0:this.cart.reduce((function(t,e){return t+e.amount*e.price}),0)}},methods:{editProduct:function(t){this.cart[t].edit=!0},delProduct:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.axios.patch("/users/cart",{product:e.cart[t]._id,amount:0},{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 3:e.cart.splice(t,1),e.$refs.table.refresh(),r.next=10;break;case 7:r.prev=7,r.t0=r["catch"](0),e.$swal({icon:"error",title:"錯誤",text:"刪除商品失敗"});case 10:case"end":return r.stop()}}),r,null,[[0,7]])})))()},submitProduct:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.axios.patch("/users/cart",{product:e.cart[t]._id,amount:e.cart[t].amountModel},{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 3:e.cart[t].amount=e.cart[t].amountModel,e.cart[t].edit=!1,e.$refs.table.refresh(),r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](0),e.$swal({icon:"error",title:"錯誤",text:"修改商品失敗"});case 11:case"end":return r.stop()}}),r,null,[[0,8]])})))()},cancelProduct:function(t){this.cart[t].edit=!1,this.cart[t].amountModel=this.cart[t].amount},checkout:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.axios.post("/users/checkout",{},{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 3:t.$router.push("/orders"),e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),t.$swal({icon:"error",title:"錯誤",text:"結帳失敗"});case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()}},mounted:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.axios.get("/users/cart",{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 3:r=e.sent,a=r.data,t.cart=a.result.map((function(t){return t=Object(c["a"])(Object(c["a"])({},t.product),{},{amount:t.amount}),t.image="".concat("https://pett-back.herokuapp.com","/files/").concat(t.image),t.edit=!1,t.amountModel=t.amount,t})),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),t.$swal({icon:"error",title:"錯誤",text:"取得購物車失敗"});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}}),s=i,u=r("2877"),l=Object(u["a"])(s,a,n,!1,null,null,null);e["default"]=l.exports}}]);
//# sourceMappingURL=cart.8c395c61.js.map